/* Copyright 2019 Brian Hackett. Released under the MIT license. */

const { generateBjerrumData } = require("../carbonate");
const { Units, Terms } = require("../units");
const { expect } = require("./utils");

const { Celsius, Salinity, pH } = Terms;

// https://coral.wiki/wiki/index.php?title=Carbonate-Script
//
// Compute Bjerrum plot data for carbonate concentrations as a function of pH.
// Note: these values are a little different from what is used in the plot on
// the wiki.
const data = generateBjerrumData(Celsius(28), Salinity(35), pH(4), pH(10), 20);
expect(data.pH.map(pH => pH.normalize(Units.pH)), [
  4,4.3,4.6,4.9,5.2,5.5,5.8,6.1,6.4,6.7,7,7.300000000000001,7.6,7.9,8.2,8.5,
  8.8,9.1,9.4,9.7,10
]);
expect(data.CO2.map(CO2 => CO2.normalize(Units.Molarity)), [
  0.984521075526212,0.969583696419006,0.9410933224090265,0.8889700081106523,
  0.8004947579655667,0.667836965822745,0.5018130225484696,0.3353017888106607,
  0.20155084443942506,0.11199784775270286,0.05911113157120767,0.030168841399686046,
  0.014996011673134,0.007235841087391797,0.0033421465853907114,0.0014422309477453868,
  0.0005649467721451162,0.0001970866496835049,0.00006147748027210752,
  0.00001757122652786634,0.0000047411998644600015
]);
expect(data.HCO3.map(HCO3 => HCO3.normalize(Units.Molarity)), [
  0.015478732301200736,0.030415550135701457,0.05890376620951797,0.11101904341693042,
  0.19946599336739912,0.33203267642187734,0.49779702797022013,0.6636609161765232,
  0.7959668739977578,0.8825108405413283,0.9293507313926656,0.9463875181866062,
  0.9386120851525607,0.9036482091746432,0.8327906985033545,0.7170429702231561,
  0.5604255200611996,0.39009248044595485,0.24278756027814646,0.13845621325410826,
  0.07454158708511233
]);
expect(data.CO3.map(CO3 => CO3.normalize(Units.Molarity)), [
  1.9217258716646185e-7,7.534452924028192e-7,0.0000029113814554707262,
  0.000010948472417309969,0.000039248667034111134,0.00013035775537761953,
  0.00038994948131036136,0.0010372950128162083,0.002482281562817255,0.00549131170596871,
  0.011538137036126517,0.02344364041370783,0.046391903174305325,0.08911594973796505,
  0.1638671549112548,0.2815147988290984,0.43900953316665514,0.6097104329043618,
  0.7571509622415814,0.8615262155193638,0.9254536717150232
]);
